<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagicPoint</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        #app {
            flex: 1;
        }
        footer {
            text-align: center;
            padding: 10px;
            background-color: #f1f1f1;
        }
        .sign-in-button {
            position: absolute;
            top: 10px;
            right: 10px;
        }
    </style>
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <meta name="google-signin-client_id" content="370153813454-lkjg1u7gurqj3vfp3adqbsoe9p2ss9ht.apps.googleusercontent.com">
</head>
<body>
    <div id="app">
        <h1>Talk</h1>
        <div class="options">
            <button class="purchase-button" data-minutes="1">1 Minutes - $1</button>
            <button class="purchase-button" data-minutes="100">100 Minutes - $20</button>
            <button class="purchase-button" data-minutes="90">200 Minutes - $35</button>
        </div>
        <button id="username" style="display:none;" onclick="showUsername()"></button>
        <div class="g-signin2 sign-in-button" data-onsuccess="onSignIn"></div>
        <div>
            <h2>Phone Number Verification</h2>
            <input type="text" id="phone-number" placeholder="Enter phone number">
            <div id="recaptcha-container"></div>
            <input type="text" id="verification-code" placeholder="Enter verification code">
            <button onclick="verifyCode()">Verify Code</button>
        </div>
    </div>
    <footer>
        <p>&copy; 2024 MAGICPOINT, INC. Version 1.0.5. Last updated: October 26, 2024 2:48:00 P.M.</p>
    </footer>
    <script>
        async function initializeFirebase() {
            const response = await fetch('/getFirebaseConfig');
            const firebaseConfig = await response.json();
            firebase.initializeApp(firebaseConfig);

            // Initialize Recaptcha verifier
            const recaptchaVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                'size': 'normal',
                'callback': (response) => {
                    // reCAPTCHA solved, allow sendVerificationCode function to run
                }
            });
        }

        initializeFirebase();

        function sendVerificationCode() {
            const phoneNumber = document.getElementById('phone-number').value;
            const appVerifier = recaptchaVerifier;
            firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
                .then((confirmationResult) => {
                    window.confirmationResult = confirmationResult;
                    alert('Verification code sent.');
                }).catch((error) => {
                    console.error('Error during signInWithPhoneNumber', error);
                });
        }

        function verifyCode() {
            const code = document.getElementById('verification-code').value;
            confirmationResult.confirm(code).then((result) => {
                const user = result.user;
                document.getElementById('sign-in').style.display = 'none';
                const usernameButton = document.getElementById('username');
                usernameButton.style.display = 'block';
                usernameButton.textContent = user.phoneNumber; // Assuming phone number as username
            }).catch((error) => {
                console.error('Error during confirmationResult.confirm', error);
            });
        }

        function showUsername() {
            const user = firebase.auth().currentUser;
            if (user) {
                alert(`Username: ${user.phoneNumber}`);
            }
        }

        function onSignIn(googleUser) {
            var profile = googleUser.getBasicProfile();
            document.querySelector('.g-signin2').style.display = 'none';
            const usernameButton = document.getElementById('username');
            usernameButton.style.display = 'block';
            usernameButton.textContent = profile.getName();
        }
    </script>
</body>
</html>